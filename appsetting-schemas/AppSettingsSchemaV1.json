{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AppSettingsSchemaV1",
  "type": "object",
  "required": ["Forge", "ForgeConfiguration"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to the JSON schema for this document"
    },
    "Forge": {
      "type": "object",
      "required": ["ServiceName", "Application"],
      "properties": {
        "ServiceName": {
          "type": "string",
          "description": "The name of the service. Typically, this is in the form 'ApplicationName-ServiceName' (ex: confac-backend)"
        },
        "TeamName": {
          "type": "string",
          "description": "The team responsible for this service (optional)"
        },
        "Tenant": {
          "type": "string",
          "description": "The tenant/organization name (optional)"
        },
        "Environment": {
          "type": "string",
          "description": "Deployment environment (e.g., Development, Staging, Production). When empty defaults to env.DOTNET_ENVIRONMENT, and then to 'Development'."
        },
        "Application": {
          "type": "string",
          "description": "The system name, which typically consists of a few services (ex: confac)"
        }
      },
      "additionalProperties": false
    },
    "ForgeConfiguration": {
      "type": "object",
      "required": [],
      "properties": {
        "Logging": {
          "type": "object",
          "required": ["FilePath"],
          "properties": {
            "FilePath": {
              "type": "string",
              "description": "File path for daily rotating log storage",
              "format": "uri-reference"
            },
            "LokiUrl": {
              "oneOf": [
                {
                  "type": "string",
                  "format": "uri",
                  "minLength": 1
                },
                {
                  "type": "string",
                  "maxLength": 0
                }
              ],
              "description": "URL for Loki logging endpoint (ex: http://loki:3100) or empty to disable"
            }
          },
          "additionalProperties": false
        },
        "Security": {
          "type": "object",
          "description": "OpenIddict security configuration. When present, enables authentication and authorization.",
          "properties": {
            "Issuer": {
              "type": "string",
              "description": "The issuer URL for tokens. If not set, defaults to the application's base URL."
            },
            "ClientId": {
              "type": "string",
              "description": "Client ID for the default SPA client. (ex: service-name-spa)",
              "default": "forge-spa"
            },
            "ClientDisplayName": {
              "type": "string",
              "description": "Display name for the default client."
            },
            "RedirectUris": {
              "type": "string",
              "description": "Allowed redirect URIs for the SPA client (comma-separated). (ex: http://localhost:3000/callback)"
            },
            "PostLogoutRedirectUris": {
              "type": "string",
              "description": "Allowed post-logout redirect URIs (comma-separated). (ex: http://localhost:3000)"
            },
            "AccessTokenLifetimeMinutes": {
              "type": "integer",
              "description": "Access token lifetime in minutes.",
              "default": 60
            },
            "RefreshTokenLifetimeDays": {
              "type": "integer",
              "description": "Refresh token lifetime in days.",
              "default": 14
            },
            "DisableAccessTokenEncryption": {
              "type": "boolean",
              "description": "When true, tokens are plain JWTs, not JWEs.",
              "default": false
            },
            "RoleCapabilities": {
              "type": "object",
              "description": "Maps roles to their capabilities. Key: role name, Value: list of capability names.",
              "additionalProperties": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "Hosting": {
      "type": "object",
      "properties": {
        "AllowedHosts": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": [],
          "description": "Array of allowed host names for the application"
        },
        "CorsOrigins": {
          "type": "string",
          "default": "*",
          "description": "The allowed CORS origin (comma-separated)"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": true
}
